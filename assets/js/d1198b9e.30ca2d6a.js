"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1940],{7557:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>d});var s=n(4848),i=n(8453);const r={title:"Setup",tags:["testing","e2e","playwright","infrastructure"]},a=void 0,o={id:"guides/e2e/setup",title:"Setup",description:"Overview",source:"@site/docs/guides/e2e/00-setup.md",sourceDirName:"guides/e2e",slug:"/guides/e2e/setup",permalink:"/guides/e2e/setup",draft:!1,unlisted:!1,editUrl:"https://github.com/strapi/strapi/tree/main/docs/docs/guides/e2e/00-setup.md",tags:[{label:"testing",permalink:"/tags/testing"},{label:"e2e",permalink:"/tags/e-2-e"},{label:"playwright",permalink:"/tags/playwright"},{label:"infrastructure",permalink:"/tags/infrastructure"}],version:"current",sidebarPosition:0,frontMatter:{title:"Setup",tags:["testing","e2e","playwright","infrastructure"]},sidebar:"guides",previous:{title:"FE Coding Guidelines",permalink:"/guides/fe-coding-guidelines"},next:{title:"App Template",permalink:"/guides/e2e/app-template"}},l={},d=[{value:"Overview",id:"overview",level:2},{value:"Get Started",id:"get-started",level:2},{value:"Running specific tests",id:"running-specific-tests",level:3},{value:"Running specific browsers",id:"running-specific-browsers",level:3},{value:"Concurrency / parallellization",id:"concurrency--parallellization",level:3},{value:"Env Variables to Control Test Config",id:"env-variables-to-control-test-config",level:3},{value:"Strapi Templates",id:"strapi-templates",level:2},{value:"What is Playwright?",id:"what-is-playwright",level:2},{value:"Running tests with environment variables",id:"running-tests-with-environment-variables",level:2},{value:"Running tests with future flags",id:"running-tests-with-future-flags",level:2},{value:"What makes a good end to end test?",id:"what-makes-a-good-end-to-end-test",level:2}];function c(e){const t={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(t.p,{children:"This document explains at a high level how we create our app instance, run the e2e tests and what technology we're using for e2e tests. As well as a small section on writing tests."}),"\n",(0,s.jsx)(t.h2,{id:"get-started",children:"Get Started"}),"\n",(0,s.jsx)(t.p,{children:"To run the e2e tests, you must first install the playwright browsers."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-shell",children:"npx playwright install\n"})}),"\n",(0,s.jsx)(t.p,{children:'Because we require a "fresh" instance to assert our e2e tests against this is included in the testing script so all you need to run is:'}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-shell",children:"yarn test:e2e\n"})}),"\n",(0,s.jsxs)(t.p,{children:["This will spawn by default a Strapi instance per testing domain (e.g. content-manager) in ",(0,s.jsx)(t.code,{children:"test-apps"})," where the an individual ",(0,s.jsx)(t.code,{children:"playwright.config"})," will start the instance and run tests against. It will automatically link the dependencies from the instance to the monorepo because ",(0,s.jsx)(t.code,{children:"test-apps"})," are not considered part of the monorepo but we want to be using the most recent version of strapi (published or development) therefore meaning our most recent code changes can be tested against."]}),"\n",(0,s.jsxs)(t.p,{children:["If you need to clean the test-apps folder because they are not working as expected, you can run ",(0,s.jsx)(t.code,{children:"yarn test:e2e clean"})," which will clean said directory."]}),"\n",(0,s.jsx)(t.h3,{id:"running-specific-tests",children:"Running specific tests"}),"\n",(0,s.jsxs)(t.p,{children:['To run only one domain, meaning a top-level directory in e2e/tests such as "admin" or "content-manager", use the ',(0,s.jsx)(t.code,{children:"--domains"})," option."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-shell",children:"yarn test:e2e --domains=admin\nnpm run test:e2e --domains=admin\n"})}),"\n",(0,s.jsxs)(t.p,{children:["To run a specific file, you can pass arguments and options to playwright using ",(0,s.jsx)(t.code,{children:"--"})," between the test",":e2e"," options and the playwright options, such as:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-shell",children:"# to run just the login.spec.ts file in the admin domain\nyarn test:e2e --domains=admin -- login.spec.ts\nnpm run test:e2e --domains=admin -- login.spec.ts\n"})}),"\n",(0,s.jsx)(t.p,{children:'Note that you must still include a domain, otherwise playwright will attempt to run every domain filtering by that filename, and any domains that do not contain that filename will fail with "no tests found"'}),"\n",(0,s.jsx)(t.h3,{id:"running-specific-browsers",children:"Running specific browsers"}),"\n",(0,s.jsxs)(t.p,{children:["To run only a specific browser (to speed up test development, for example) you can pass ",(0,s.jsx)(t.code,{children:"--project"})," to playwright with the value(s) ",(0,s.jsx)(t.code,{children:"chromium"}),", ",(0,s.jsx)(t.code,{children:"firefox"}),", or ",(0,s.jsx)(t.code,{children:"webkit"})]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-shell",children:"yarn test:e2e --domains=admin -- login.spec.ts --project=chromium\nnpm run test:e2e --domains=admin -- login.spec.ts --project=chromium\n"})}),"\n",(0,s.jsx)(t.h3,{id:"concurrency--parallellization",children:"Concurrency / parallellization"}),"\n",(0,s.jsx)(t.p,{children:"By default, every domain is run with its own test app in parallel with the other domains. The tests within a domain are run in series, one at a time."}),"\n",(0,s.jsxs)(t.p,{children:["If you need an easier way to view the output, or have problems running multiple apps at once on your system, you can use the ",(0,s.jsx)(t.code,{children:"-c"})," option"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-shell",children:"# only run one domain at a time\nyarn test:e2e -c 1\n"})}),"\n",(0,s.jsx)(t.h3,{id:"env-variables-to-control-test-config",children:"Env Variables to Control Test Config"}),"\n",(0,s.jsx)(t.p,{children:"Some helpers have been added to allow you to modify the playwright configuration on your own system without touching the playwright config file used by the test runner."}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"env var"}),(0,s.jsx)(t.th,{children:"Description"}),(0,s.jsx)(t.th,{children:"Default"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"PLAYWRIGHT_WEBSERVER_TIMEOUT"}),(0,s.jsx)(t.td,{children:"timeout for starting the Strapi server"}),(0,s.jsx)(t.td,{children:"16000 (160s)"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"PLAYWRIGHT_ACTION_TIMEOUT"}),(0,s.jsx)(t.td,{children:"playwright action timeout (ie, click())"}),(0,s.jsx)(t.td,{children:"15000 (15s)"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"PLAYWRIGHT_EXPECT_TIMEOUT"}),(0,s.jsx)(t.td,{children:"playwright expect waitFor timeout"}),(0,s.jsx)(t.td,{children:"10000 (10s)"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"PLAYWRIGHT_TIMEOUT"}),(0,s.jsx)(t.td,{children:"playwright timeout, for each individual test"}),(0,s.jsx)(t.td,{children:"30000 (30s)"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"PLAYWRIGHT_OUTPUT_DIR"}),(0,s.jsx)(t.td,{children:"playwright output dir, such as trace files"}),(0,s.jsx)(t.td,{children:"'../test-results/'"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"PLAYWRIGHT_VIDEO"}),(0,s.jsx)(t.td,{children:"set 'true' to save videos on failed tests"}),(0,s.jsx)(t.td,{children:"false"})]})]})]}),"\n",(0,s.jsx)(t.h2,{id:"strapi-templates",children:"Strapi Templates"}),"\n",(0,s.jsxs)(t.p,{children:["The test-app you create uses a ",(0,s.jsx)(t.a,{href:"https://docs.strapi.io/developer-docs/latest/setup-deployment-guides/installation/templates.html",children:"template"})," found at ",(0,s.jsx)(t.code,{children:"e2e/app-template"})," in this folder we can store our premade content schemas & any customisations we may need such as other plugins / custom fields / endpoints etc."]}),"\n",(0,s.jsxs)(t.p,{children:["If you add anything to the template, be sure to add this information to ",(0,s.jsx)(t.a,{href:"/testing/e2e/app-template",children:"the docs"}),"."]}),"\n",(0,s.jsx)(t.h2,{id:"what-is-playwright",children:"What is Playwright?"}),"\n",(0,s.jsx)(t.p,{children:"Playwright enables reliable end-to-end testing for modern web apps. It's cross browser, cross platform and cross language. At Strapi we use it for Javascript automated testing."}),"\n",(0,s.jsxs)(t.p,{children:["For more information check out their ",(0,s.jsx)(t.a,{href:"https://playwright.dev/docs/intro",children:"docs"}),". If you're struggling with their APIs, then check out their specific ",(0,s.jsx)(t.a,{href:"https://playwright.dev/docs/api/class-playwright",children:"API documentation"}),"."]}),"\n",(0,s.jsx)(t.h2,{id:"running-tests-with-environment-variables",children:"Running tests with environment variables"}),"\n",(0,s.jsxs)(t.p,{children:["To set specific environment variables for your tests, a ",(0,s.jsx)(t.code,{children:".env"})," file can be created in the root of the e2e folder. This is useful if you need to run tests with a Strapi license or set future flags."]}),"\n",(0,s.jsx)(t.h2,{id:"running-tests-with-future-flags",children:"Running tests with future flags"}),"\n",(0,s.jsxs)(t.p,{children:["If you are writing tests for an unstable future feature you will need to add ",(0,s.jsx)(t.code,{children:"app-template/config/features.js"}),". Currently the app template generation does not take the config folder into consideration. However, the run-e2e-tests script will apply the features config to the generated app. See the documentation for ",(0,s.jsx)(t.a,{href:"https://docs.strapi.io/dev-docs/configurations/features#enabling-a-future-flag",children:"features.js"})]}),"\n",(0,s.jsx)(t.h2,{id:"what-makes-a-good-end-to-end-test",children:"What makes a good end to end test?"}),"\n",(0,s.jsx)(t.p,{children:"This is the million dollar question. E2E tests typically test complete user flows that touch numerous points of the application it's testing, we're not interested in what happens during a process, only the user perspective and end results. Consider writing them with your story hat on. E.g. \"As a user I want to create a new entity, publish that entity, and then be able to retrieve its data from the content API\"."}),"\n",(0,s.jsxs)(t.p,{children:["Our E2E test suite should ",(0,s.jsx)(t.em,{children:"at minimum"})," cover the core business flows of the product and this is lead by the QA defined set for this. Consult with your QA if you're not sure."]})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>o});var s=n(6540);const i={},r=s.createContext(i);function a(e){const t=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(r.Provider,{value:t},e.children)}}}]);