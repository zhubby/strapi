"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[6383],{9359:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>o,contentTitle:()=>l,default:()=>c,frontMatter:()=>s,metadata:()=>d,toc:()=>r});var n=a(4848),i=a(8453);const s={title:"App Template",tags:["testing","e2e","template","infrastructure"]},l=void 0,d={id:"guides/e2e/app-template",title:"App Template",description:"Overview",source:"@site/docs/guides/e2e/01-app-template.md",sourceDirName:"guides/e2e",slug:"/guides/e2e/app-template",permalink:"/guides/e2e/app-template",draft:!1,unlisted:!1,editUrl:"https://github.com/strapi/strapi/tree/main/docs/docs/guides/e2e/01-app-template.md",tags:[{label:"testing",permalink:"/tags/testing"},{label:"e2e",permalink:"/tags/e-2-e"},{label:"template",permalink:"/tags/template"},{label:"infrastructure",permalink:"/tags/infrastructure"}],version:"current",sidebarPosition:1,frontMatter:{title:"App Template",tags:["testing","e2e","template","infrastructure"]},sidebar:"guides",previous:{title:"Setup",permalink:"/guides/e2e/setup"},next:{title:"Data Transfer",permalink:"/guides/e2e/data-transfer"}},o={},r=[{value:"Overview",id:"overview",level:2},{value:"Update the app template",id:"update-the-app-template",level:2},{value:"Content Schemas",id:"content-schemas",level:2},{value:"Article",id:"article",level:3},{value:"Author",id:"author",level:3},{value:"Homepage",id:"homepage",level:3},{value:"API Customisations",id:"api-customisations",level:2},{value:"Database",id:"database",level:3},{value:"Usage",id:"usage",level:4},{value:"What does it do?",id:"what-does-it-do",level:4},{value:"Why do we have it?",id:"why-do-we-have-it",level:4},{value:"Config",id:"config",level:3},{value:"Rate Limit",id:"rate-limit",level:4},{value:"Usage",id:"usage-1",level:5},{value:"What does it do?",id:"what-does-it-do-1",level:5},{value:"Why do we have it?",id:"why-do-we-have-it-1",level:5},{value:"Admin Auto Open",id:"admin-auto-open",level:4},{value:"Usage",id:"usage-2",level:5},{value:"What does it do?",id:"what-does-it-do-2",level:5},{value:"Why do we have it?",id:"why-do-we-have-it-2",level:5}];function h(e){const t={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",h5:"h5",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h2,{id:"overview",children:"Overview"}),"\n",(0,n.jsxs)(t.p,{children:["An app template has been created in ",(0,n.jsx)(t.code,{children:"e2e/app-template"})," which provide some customizations and utilities to allow the tests to run. Note that if any changes are made to the app template, you will need to run ",(0,n.jsx)(t.code,{children:"yarn test:e2e:clean"})," to update the test apps with the new template."]}),"\n",(0,n.jsx)(t.p,{children:"Here you can read about what content schemas the test instance has & the API customisations we've built (incl. why we built them)."}),"\n",(0,n.jsx)(t.h2,{id:"update-the-app-template",children:"Update the app template"}),"\n",(0,n.jsx)(t.p,{children:"To update the app template:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["run the tests to create a Strapi app based on the existing template at ",(0,n.jsx)(t.code,{children:"test-apps/e2e/test-app-<number>"}),"."]}),"\n",(0,n.jsxs)(t.li,{children:["Move into this folder and run ",(0,n.jsx)(t.code,{children:"yarn develop"}),"."]}),"\n",(0,n.jsxs)(t.li,{children:["Login using the credentials found in ",(0,n.jsx)(t.code,{children:"e2e/constants.js"}),"."]}),"\n",(0,n.jsx)(t.li,{children:"Make any changes you need (i.e. create a content-type)."}),"\n",(0,n.jsxs)(t.li,{children:["Kill the server and run ",(0,n.jsxs)(t.a,{href:"https://docs.strapi.io/dev-docs/cli#strapi-templatesgenerate",children:["[",(0,n.jsx)(t.code,{children:"yarn strapi templates:generate <path>"}),"]"]}),"."]}),"\n",(0,n.jsxs)(t.li,{children:["Replace the existing template in ",(0,n.jsx)(t.code,{children:"e2e/app-template"})," with the newly generated one."]}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"content-schemas",children:"Content Schemas"}),"\n",(0,n.jsx)(t.h3,{id:"article",children:"Article"}),"\n",(0,n.jsxs)(t.p,{children:["A collection type, the schema can be found in: ",(0,n.jsx)(t.code,{children:"e2e/app-template/template/src/api/article/content-types/article/schema.json"})]}),"\n",(0,n.jsx)(t.h3,{id:"author",children:"Author"}),"\n",(0,n.jsxs)(t.p,{children:["A collection type, the schema can be found in ",(0,n.jsx)(t.code,{children:"e2e/app-template/template/src/api/article/content-types/author/schema.json"})]}),"\n",(0,n.jsx)(t.h3,{id:"homepage",children:"Homepage"}),"\n",(0,n.jsxs)(t.p,{children:["A single type, the schema can be found in ",(0,n.jsx)(t.code,{children:"e2e/app-template/template/src/api/homepage/content-types/homepage/schema.json"})]}),"\n",(0,n.jsx)(t.h2,{id:"api-customisations",children:"API Customisations"}),"\n",(0,n.jsx)(t.h3,{id:"database",children:"Database"}),"\n",(0,n.jsxs)(t.p,{children:["Found at ",(0,n.jsx)(t.code,{children:"template/src/api/database"})]}),"\n",(0,n.jsx)(t.h4,{id:"usage",children:"Usage"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-ts",children:"import { test } from '@playwright/test';\n\ntest.beforeEach(async ({ page }) => {\n  await page.request.fetch('http://localhost:1337/api/database/dump', {\n    method: 'POST',\n  });\n});\n"})}),"\n",(0,n.jsxs)(t.p,{children:["This endpoint does not have a ",(0,n.jsx)(t.code,{children:"body"}),"."]}),"\n",(0,n.jsx)(t.h4,{id:"what-does-it-do",children:"What does it do?"}),"\n",(0,n.jsxs)(t.p,{children:["This endpoint ",(0,n.jsx)(t.code,{children:"DELETES"})," every row from every table ",(0,n.jsx)(t.em,{children:"excluding"}),' the "core" tables \u2013 normally prefixed with ',(0,n.jsx)(t.code,{children:"strapi_"}),"."]}),"\n",(0,n.jsx)(t.h4,{id:"why-do-we-have-it",children:"Why do we have it?"}),"\n",(0,n.jsxs)(t.p,{children:["This lets us wipe the entire test instance ",(0,n.jsx)(t.em,{children:"if"})," we need to. DTS does technically\ndo this already for us. But nonetheless, its useful."]}),"\n",(0,n.jsx)(t.h3,{id:"config",children:"Config"}),"\n",(0,n.jsxs)(t.p,{children:["found at ",(0,n.jsx)(t.code,{children:"template/src/api/config"})]}),"\n",(0,n.jsx)(t.h4,{id:"rate-limit",children:"Rate Limit"}),"\n",(0,n.jsx)(t.h5,{id:"usage-1",children:"Usage"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-ts",children:"async function toggleRateLimiting(page, enabled = true) {\n  await page.request.fetch('/api/config/ratelimit/enable', {\n    method: 'POST',\n    data: { value: enabled },\n  });\n}\n"})}),"\n",(0,n.jsx)(t.h5,{id:"what-does-it-do-1",children:"What does it do?"}),"\n",(0,n.jsx)(t.p,{children:"This endpoint can be used to enable or disable the rate limitting middleware in\nstrapi. When enabled login requests for each user are limitted to 5 in 5 minutes."}),"\n",(0,n.jsx)(t.h5,{id:"why-do-we-have-it-1",children:"Why do we have it?"}),"\n",(0,n.jsx)(t.p,{children:"There are cases where we disable the rate limit to test multiple incorrect login\nattempts."}),"\n",(0,n.jsx)(t.h4,{id:"admin-auto-open",children:"Admin Auto Open"}),"\n",(0,n.jsx)(t.h5,{id:"usage-2",children:"Usage"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-ts",children:"  bootstrap({ strapi }) {\n    strapi.service('api::config.config').adminAutoOpenEnable(false);\n  },\n"})}),"\n",(0,n.jsx)(t.h5,{id:"what-does-it-do-2",children:"What does it do?"}),"\n",(0,n.jsx)(t.p,{children:"This endpoint can be used to enable or disable admin auto open."}),"\n",(0,n.jsx)(t.h5,{id:"why-do-we-have-it-2",children:"Why do we have it?"}),"\n",(0,n.jsx)(t.p,{children:"It can be frustrating to work with the e2e tests locally. If auto open is set to\ntrue a browser window will open each time you run the e2e tests as the strapi\napp starts for the first time. Because of this we disable it during the\nbootstrap phase of the test app instance."})]})}function c(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(h,{...e})}):h(e)}},8453:(e,t,a)=>{a.d(t,{R:()=>l,x:()=>d});var n=a(6540);const i={},s=n.createContext(i);function l(e){const t=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),n.createElement(s.Provider,{value:t},e.children)}}}]);